{% extends 'base.html.twig' %}

{% block title %}{{ user.name }} - Perfil{% endblock %}

{% block body %}
    <div class="main-container">
        <aside style="flex: 1; margin-right: 40px;">
            <div class="section-container">
                {# Botón de navegación #}
                <div style="margin-bottom: 20px;">
                    <a href="javascript:history.back()" style="color: #cdc832; text-decoration: none; font-size: 0.9rem;">
                        ← Volver atrás
                    </a>
                </div>

                <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;">
                    <div class="profile-avatar-container" style="position: relative; width: 140px; height: 140px; margin: 0 auto 20px auto;">

                        {# Foto del perfil #}
                        <div style="width: 130px; height: 130px; border-radius: 50%; overflow: hidden; border: 3px solid #cdc832; background: #071926;">
                            {% if user.foto %}
                                <img src="{{ asset('uploads/avatars/' ~ user.foto) }}?v={{ 'now'|date('U') }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                                <img src="{{ asset('img/default-user-profile.png') }}" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.7;">
                            {% endif %}
                        </div>

                        {# SOLO MOSTRAR EDICIÓN SI ES MI PERFIL #}
                        {% if app.user and app.user.id == user.id %}
                            {# Botón: Subir/Actualizar #}
                            <form action="{{ path('user_update_avatar') }}" method="POST" enctype="multipart/form-data" id="avatarForm">
                                <label for="avatar_input" class="btn-add-photo">
                                    <span>+</span>
                                    <input type="file" id="avatar_input" name="avatar" style="display: none;" onchange="document.getElementById('avatarForm').submit();">
                                </label>
                            </form>

                            {% if user.foto %}
                                <form action="{{ path('user_delete_avatar') }}" method="POST" id="formDeleteFoto">
                                    <button type="button" class="btn-delete-photo" onclick="abrirModalBorrarFoto()">✕</button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>

                <div id="main-data">
                    <p>Nombre: <span class="userDataText">{{ user.name }}</span></p>
                    <hr style="margin-top:10px;margin-bottom: 10px; border: 0.5px solid rgba(255,255,255,0.1)">
                    <p style="margin-bottom: 5px">Correo: <span class="userDataText">{{ user.email }}</span></p>
                </div>
            </div>
        </aside>

        {# Listado de Torneos #}
        <section class="section-container" style="flex: 2;">
            <h2>Mis torneos</h2>
            <hr>

            {% if torneos is not empty %}
                <div class="stats-table-container">
                    <table class="stats-table">
                        <thead>
                        <tr>
                            <th>Torneo</th>
                            <th style="text-align: center;">Seguidores</th>
                            <th style="text-align: right;">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for torneo in torneos %}
                            <tr>
                                <td>
                                    <strong style="color: #cdc832;">{{ torneo.name }}</strong>
                                </td>
                                <td style="text-align: center;">{{ torneo.seguidores }}</td>
                                <td style="text-align: right;">
                                    <a href="{{ path('torneo', {'id': torneo.id}) }}" class="card-img" style="display: inline-flex; width: auto; padding: 5px 15px;">
                                        Ver detalles
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div id="main-data" style="text-align: center; padding: 40px;">
                    <p>No has creado ningún torneo todavía.</p>
                    <a href="{{ path('crear-torneo') }}" class="hero-cta" style="margin-top: 15px;">Crear mi primer torneo</a>
                </div>
            {% endif %}
        </section>
    </div>
    {{ include('modals/_eliminarFotoPerfil.html.twig') }}
{% endblock %}